üèÜ Blinkoff IoT Platform
–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–∞—è IoT-–ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —É–º–Ω—ã–º–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏ (–∏–Ω–∫—É–±–∞—Ç–æ—Ä—ã, —Ç–µ–ø–ª–∏—Ü—ã –∏ —Ç–¥.).

üèõ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
–ü—Ä–æ–µ–∫—Ç –ø–æ—Å—Ç—Ä–æ–µ–Ω –Ω–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ **Secure Event-Driven Modular Monolith**.

  * **Modular:** –°–∏—Å—Ç–µ–º–∞ —Ä–∞–∑–¥–µ–ª–µ–Ω–∞ –Ω–∞ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–µ –±–∏–∑–Ω–µ—Å-–º–æ–¥—É–ª–∏ (Telemetry, Device Management, Notification).
  * **Event-Driven:** –ú–æ–¥—É–ª–∏ —Å–ª–∞–±–æ —Å–≤—è–∑–∞–Ω—ã –∏ –æ–±—â–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ —Å–æ–±—ã—Ç–∏—è (Spring Events) –∏ –±—Ä–æ–∫–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π (Kafka).
  * **Secure:** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è End-to-End —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö (AES-128) –ø–æ–≤–µ—Ä—Ö –∑–∞—â–∏—â–µ–Ω–Ω–æ–≥–æ –∫–∞–Ω–∞–ª–∞ (WSS).
  * **Agnostic Data:** –•—Ä–∞–Ω–µ–Ω–∏–µ —Ç–µ–ª–µ–º–µ—Ç—Ä–∏–∏ –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSONB –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–¥–∫–ª—é—á–∞—Ç—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ —Å –ª—é–±–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π –¥–∞—Ç—á–∏–∫–æ–≤ –±–µ–∑ –º–∏–≥—Ä–∞—Ü–∏–∏ –ë–î.

-----

## üõ† –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

### Core

  * **Language:** Java 21 (LTS)
  * **Framework:** Spring Boot 3.4.12
  * **Build Tool:** Maven

### Data & Storage

  * **Database:** PostgreSQL 15 (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `JSONB` –¥–ª—è –≥–∏–±–∫–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö).
  * **ORM:** Spring Data JPA + Hibernate 6.6.
  * **Libraries:** `hypersistence-utils` (–¥–ª—è –º–∞–ø–ø–∏–Ω–≥–∞ JSONB).
  * **Cache:** Redis (–¥–ª—è –≥–æ—Ä—è—á–µ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏–π –∏ —Å–µ—Å—Å–∏–π).

### Communication & Async

  * **Protocols:** WebSocket (Real-time), REST API.
  * **Message Broker:** Apache Kafka (–¥–ª—è –∞–ª–µ—Ä—Ç–æ–≤ –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π).
  * **Format:** JSON (Payload).

### Security

  * **Encryption:** AES-128 (—Å–∏–º–º–µ—Ç—Ä–∏—á–Ω–æ–µ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª–µ–∑–Ω–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏).
  * **Auth:** JWT (–¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π), Master Keys / Device Tokens (–¥–ª—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤).

### Infrastructure

  * **Containerization:** Docker, Docker Compose.
  * **Monitoring:** Spring Actuator.

-----

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ü—Ä–æ–µ–∫—Ç–∞

–ü—Ä–æ–µ–∫—Ç —Å–ª–µ–¥—É–µ—Ç –ø—Ä–∏–Ω—Ü–∏–ø–∞–º **Package by Feature**, —Ä–∞–∑–¥–µ–ª—è—è –æ–±—â–µ–µ —è–¥—Ä–æ (Shared Kernel) –∏ –±–∏–∑–Ω–µ—Å-–º–æ–¥—É–ª–∏.

```text
src/main/java/com/blinkoff/iot
‚îú‚îÄ‚îÄ BlinkoffIoTApplication.java        // –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îÇ
‚îú‚îÄ‚îÄ shared                             // üß± SHARED KERNEL (–û–±—â–∏–µ —É—Ç–∏–ª–∏—Ç—ã –∏ –∫–æ–Ω—Ñ–∏–≥–∏)
‚îÇ   ‚îú‚îÄ‚îÄ config                         // Security, Redis, Kafka, Swagger Configs
‚îÇ   ‚îú‚îÄ‚îÄ security
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ crypto                     // –õ–æ–≥–∏–∫–∞ AES-128 (Encrypt/Decrypt)
‚îÇ   ‚îú‚îÄ‚îÄ event                          // –°–æ–±—ã—Ç–∏—è (DeviceErrorEvent, DeviceTelemetryEvent)
‚îÇ   ‚îî‚îÄ‚îÄ exception                      // Global Exception Handler
‚îÇ
‚îî‚îÄ‚îÄ modules                            // üì¶ –ë–ò–ó–ù–ï–°-–ú–û–î–£–õ–ò
    ‚îÇ
    ‚îú‚îÄ‚îÄ device_management              // üõ† –£–ß–ï–¢ –£–°–¢–†–û–ô–°–¢–í
    ‚îÇ   ‚îú‚îÄ‚îÄ model                      // –°—É—â–Ω–æ—Å—Ç–∏: Device, DeviceBinding (User <-> Chip)
    ‚îÇ   ‚îú‚îÄ‚îÄ repository                 // –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ (PostgreSQL)
    ‚îÇ   ‚îî‚îÄ‚îÄ service                    // –õ–æ–≥–∏–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–¥–æ–≤ –ø—Ä–∏–≤—è–∑–∫–∏
    ‚îÇ
    ‚îú‚îÄ‚îÄ telemetry                      // üå° –Ø–î–†–û REAL-TIME (–û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö)
    ‚îÇ   ‚îú‚îÄ‚îÄ api
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ device_facing          // WebSocket Handler –¥–ª—è ESP32 (Binary + AES)
    ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ client_facing          // WebSocket Handler –¥–ª—è Android (JSON + JWT)
    ‚îÇ   ‚îú‚îÄ‚îÄ store                      // –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ (In-Memory -> Redis)
    ‚îÇ   ‚îú‚îÄ‚îÄ engine                     // –î–≤–∏–∂–æ–∫ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ (Memory -> DB) –∏ SessionRouter
    ‚îÇ   ‚îî‚îÄ‚îÄ service                    // –§–∞—Å–∞–¥ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤
    ‚îÇ
    ‚îî‚îÄ‚îÄ notification                   // üîî –ê–õ–ï–†–¢–ò–ù–ì –ò –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø
        ‚îú‚îÄ‚îÄ service                    // –°–ª—É—à–∞—Ç–µ–ª—å —Å–æ–±—ã—Ç–∏–π (–∞–Ω–∞–ª–∏–∑ –æ—à–∏–±–æ–∫)
        ‚îî‚îÄ‚îÄ kafka                      // Producer (–æ—Ç–ø—Ä–∞–≤–∫–∞ –≤ —Ç–æ–ø–∏–∫ 'iot-errors')
```

-----

## üîÑ –°—Ü–µ–Ω–∞—Ä–∏–∏ –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è (Data Flow)

### 1Ô∏è‚É£ –°—Ç–∞–¥–∏—è MVP (–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è)

*–§–æ–∫—É—Å: –ü—Ä–∏–µ–º –¥–∞–Ω–Ω—ã—Ö, –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å, –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö.*

**–ê. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (Ingestion):**

1.  **ESP32** —Å–æ–±–∏—Ä–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ, —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç JSON, —à–∏—Ñ—Ä—É–µ—Ç –µ–≥–æ **Master Key** (AES-128) –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –±–∏–Ω–∞—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ WebSocket.
2.  **Server (Telemetry)** –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –±–∞–π—Ç—ã, –¥–µ—à–∏—Ñ—Ä—É–µ—Ç –∏—Ö –Ω–∞ –ª–µ—Ç—É.
3.  –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–π –ø–∞–º—è—Ç–∏ (ConcurrentHashMap / Redis) –¥–ª—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞.
4.  –§–æ–Ω–æ–≤—ã–π –ø—Ä–æ—Ü–µ—Å—Å (**Sync Service**) —Ä–∞–∑ –≤ 10 –º–∏–Ω—É—Ç —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç –∞–∫—Ç—É–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤ PostgreSQL (`device_states`).

**–ë. –û–±—Ä–∞–±–æ—Ç–∫–∞ –ê–≤–∞—Ä–∏–π (Alerting):**

1.  **ESP32** –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç —Å–±–æ–π (Edge Computing) –∏ —à–ª–µ—Ç —Ñ–ª–∞–≥ `{"error": "Sensor Fail"}`.
2.  **Server** –ø—Ä–∏ –¥–µ—à–∏—Ñ—Ä–æ–≤–∫–µ –≤–∏–¥–∏—Ç –æ—à–∏–±–∫—É –∏ –ø—É–±–ª–∏–∫—É–µ—Ç –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ —Å–æ–±—ã—Ç–∏–µ `DeviceErrorEvent`.
3.  **Notification Module** –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç —Å–æ–±—ã—Ç–∏–µ –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ **Kafka**.
4.  –í–Ω–µ—à–Ω–∏–π —Å–µ—Ä–≤–∏—Å (Telegram Bot) –≤—ã—á–∏—Ç—ã–≤–∞–µ—Ç Kafka –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤–ª–∞–¥–µ–ª—å—Ü—É.

**–í. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è (Provisioning):**

1.  –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∫–æ–¥ –ø—Ä–∏–≤—è–∑–∫–∏ —á–µ—Ä–µ–∑ Android (BLE -\> HTTPS).
2.  –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç –∫–æ–¥ –±–æ—Ç—É (`/reg 123-456`).
3.  –°–µ—Ä–≤–µ—Ä —Å–æ–∑–¥–∞–µ—Ç –∑–∞–ø–∏—Å—å –≤ —Ç–∞–±–ª–∏—Ü–µ `device_bindings`, —Å–≤—è–∑—ã–≤–∞—è Telegram ChatID —Å ChipID.

-----

### 2Ô∏è‚É£ –°—Ç–∞–¥–∏—è "Full Platform" (–ü–ª–∞–Ω—ã —Ä–∞–∑–≤–∏—Ç–∏—è)

*–§–æ–∫—É—Å: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏, Android-—à–ª—é–∑.*

**–ê. –°–µ—Ä–≤–µ—Ä –∫–∞–∫ –®–ª—é–∑ (Gateway):**
–°–µ—Ä–≤–µ—Ä –≤—ã—Å—Ç—É–ø–∞–µ—Ç –∫–∞–∫ –¥–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω–∏–π –∫–æ–º–º—É—Ç–∞—Ç–æ—Ä –º–µ–∂–¥—É –º–æ–±–∏–ª—å–Ω—ã–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º –∏ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–º.

1.  **Android App** –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –ø–æ WebSocket (Secure WSS) —Å JWT-—Ç–æ–∫–µ–Ω–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
2.  –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∫–æ–º–∞–Ω–¥—É: `{"cmd": "LIGHT_ON"}`.
3.  **Session Router** –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:
      * –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ (—á–µ—Ä–µ–∑ —Ç–∞–±–ª–∏—Ü—É `device_bindings`).
      * –ù–∞—Ö–æ–¥–∏—Ç –∞–∫—Ç–∏–≤–Ω—É—é WebSocket-—Å–µ—Å—Å–∏—é —Ü–µ–ª–µ–≤–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ (ESP32).
      * –®–∏—Ñ—Ä—É–µ—Ç –∫–æ–º–∞–Ω–¥—É –∫–ª—é—á–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞.
      * –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –±–∞–π—Ç—ã –Ω–∞ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä.
4.  **ESP32** –∏—Å–ø–æ–ª–Ω—è–µ—Ç –∫–æ–º–∞–Ω–¥—É –∏ –ø—Ä–∏—Å—ã–ª–∞–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –º–≥–Ω–æ–≤–µ–Ω–Ω–æ —Ç—Ä–∞–Ω—Å–ª–∏—Ä—É–µ—Ç—Å—è –æ–±—Ä–∞—Ç–Ω–æ –≤ Android.

-----

## üíæ –°—Ö–µ–º–∞ –ë–∞–∑—ã –î–∞–Ω–Ω—ã—Ö (PostgreSQL)

1.  **`devices`**: –†–µ–µ—Å—Ç—Ä —Ñ–∏–∑–∏—á–µ—Å–∫–∏—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ (Meta-data, JSONB —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏).
2.  **`device_states`**: "–¶–∏—Ñ—Ä–æ–≤–æ–π –¥–≤–æ–π–Ω–∏–∫". –•—Ä–∞–Ω–∏—Ç –ø–æ—Å–ª–µ–¥–Ω–µ–µ –∏–∑–≤–µ—Å—Ç–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (JSONB `current_params`).
3.  **`device_bindings`**: –¢–∞–±–ª–∏—Ü–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞. –°–≤—è–∑—ã–≤–∞–µ—Ç –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (Telegram/Android) —Å –£—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏ –∏ —Ä–æ–ª—è–º–∏ (OWNER, VIEWER).

-----

*Developed by Blinkoff. 2025.*
