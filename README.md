–í–æ—Ç –∞–∫—Ç—É–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø—Ä–æ–µ–∫—Ç–∞ **Blinkoff IoT Platform** –Ω–∞ –º–æ–º–µ–Ω—Ç –æ–∫–æ–Ω—á–∞–Ω–∏—è **–ù–µ–¥–µ–ª–∏ 3** (–°—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏—è, –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å, HTTP API).

–ú—ã —É–±—Ä–∞–ª–∏ –ø–æ–∫–∞ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —á–∞—Å—Ç–∏ (Kafka, Redis, Android) –∏ —Å—Ñ–æ–∫—É—Å–∏—Ä–æ–≤–∞–ª–∏—Å—å –Ω–∞ —Ç–æ–º, —á—Ç–æ —Ä–µ–∞–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–µ–π—á–∞—Å.

-----

# üèÜ Blinkoff IoT Platform (Current State)

**Secure Modular Monolith** –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è IoT-—É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏ —Å –≥–∏–±—Ä–∏–¥–Ω—ã–º —Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –¥–∞–Ω–Ω—ã—Ö (RAM + DB).

## üèõ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

  * **Modular Monolith:** –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –µ–¥–∏–Ω–æ, –Ω–æ —á–µ—Ç–∫–æ —Ä–∞–∑–¥–µ–ª–µ–Ω–æ –Ω–∞ –º–æ–¥—É–ª–∏ (`telemetry`, `device_management`), –∫–æ—Ç–æ—Ä—ã–µ –æ–±—â–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ Java-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã.
  * **Hybrid State Management:**
      * **–ì–æ—Ä—è—á–∏–µ –¥–∞–Ω–Ω—ã–µ (Real-time):** –°—Ç–∞—Ç—É—Å—ã (`online`/`offline`), —Ç–µ–∫—É—â–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –∏ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ **RAM** (`ConcurrentHashMap`). –≠—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–π –æ—Ç–∫–ª–∏–∫.
      * **–•–æ–ª–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (Persistence):** –î–∞–Ω–Ω—ã–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è –≤ **PostgreSQL** –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ (Write-Behind) –∏–ª–∏ –ø—Ä–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö (—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è/–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞).
  * **Security First:**
      * –í–µ—Å—å —Ç—Ä–∞—Ñ–∏–∫ —É—Å—Ç—Ä–æ–π—Å—Ç–≤ —à–∏—Ñ—Ä—É–µ—Ç—Å—è **AES-GCM**.
      * –£—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä—É—é—Ç—Å—è –ø–æ `ChipId` + –ë–µ–ª—ã–π —Å–ø–∏—Å–æ–∫ (Cache).
      * –ü—Ä–∏–≤—è–∑–∫–∞ –∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —á–µ—Ä–µ–∑ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ **OTP-—Ç–æ–∫–µ–Ω—ã**.

-----

## üõ† –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

  * **Core:** Java 21, Spring Boot 3.4.x.
  * **Database:** PostgreSQL 15 (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `JSONB` –¥–ª—è –≥–∏–±–∫–æ—Å—Ç–∏).
  * **Protocol:**
      * **WebSocket (Text):** –û–±–º–µ–Ω –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ Base64-—Å—Ç—Ä–æ–∫–∞–º–∏ —Å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏.
      * **HTTP REST:** API –¥–ª—è Telegram-–±–æ—Ç–∞ –∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è.
  * **Security:** AES-128 (GCM), In-Memory Token Store.

-----

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ (–ê–∫—Ç—É–∞–ª—å–Ω–∞—è)

```text
src/main/java/com/blinkoff/iot
‚îú‚îÄ‚îÄ BlinkoffIoTApplication.java         // üö¶ –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞, @EnableScheduling
‚îÇ
‚îú‚îÄ‚îÄ shared                              // üß± –û–ë–©–ï–ï –Ø–î–†–û
‚îÇ   ‚îú‚îÄ‚îÄ config
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AppConstants.java           // –õ–∏–º–∏—Ç—ã (10 —É—Å—Ç—Ä/—é–∑–µ—Ä)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ WebSocketConfig.java        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ /ws/device
‚îÇ   ‚îú‚îÄ‚îÄ exception                       // –ì–ª–æ–±–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ (400, 404, 500)
‚îÇ   ‚îî‚îÄ‚îÄ security
‚îÇ       ‚îî‚îÄ‚îÄ crypto                      // AesCryptoEngine (–õ–æ–≥–∏–∫–∞ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è)
‚îÇ
‚îî‚îÄ‚îÄ modules                             // üì¶ –ë–ò–ó–ù–ï–°-–ú–û–î–£–õ–ò
    ‚îÇ
    ‚îú‚îÄ‚îÄ device_management               // üõ† –£–ü–†–ê–í–õ–ï–ù–ò–ï (CRUD, API)
    ‚îÇ   ‚îú‚îÄ‚îÄ controller                  // REST API (Endpoints)
    ‚îÇ   ‚îú‚îÄ‚îÄ service                     // –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ DeviceProvisioningService.java  // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è, –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ DeviceBindingService.java       // –ü—Ä–∏–≤—è–∑–∫–∞ (–æ–±–º–µ–Ω Token -> ChipId)
    ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ DeviceDataService.java          // –°–±–æ—Ä–∫–∞ DTO (RAM + DB override)
    ‚îÇ   ‚îú‚îÄ‚îÄ store
    ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ProvisioningTokenStore.java     // ‚ö° RAM: –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã –ø—Ä–∏–≤—è–∑–∫–∏
    ‚îÇ   ‚îú‚îÄ‚îÄ dto                         // JSON –æ–±—ä–µ–∫—Ç—ã (Request/Response)
    ‚îÇ   ‚îú‚îÄ‚îÄ model                       // Entity: Device, DeviceBinding
    ‚îÇ   ‚îî‚îÄ‚îÄ repository                  // Spring Data JPA
    ‚îÇ
    ‚îî‚îÄ‚îÄ telemetry                       // üå° –¢–ï–õ–ï–ú–ï–¢–†–ò–Ø (Real-time)
        ‚îú‚îÄ‚îÄ api
        ‚îÇ   ‚îî‚îÄ‚îÄ device_facing           // WebSocket —Å–ª–æ–π
        ‚îÇ       ‚îú‚îÄ‚îÄ DeviceHandler.java              // –ü—Ä–∏–µ–º —Å–æ–æ–±—â–µ–Ω–∏–π, –î–µ—à–∏—Ñ—Ä–æ–≤–∫–∞, –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ RAM
        ‚îÇ       ‚îî‚îÄ‚îÄ DeviceHandshakeInterceptor.java // –ü—Ä–æ–≤–µ—Ä–∫–∞ Header X-Chip-Id + AuthCache
        ‚îú‚îÄ‚îÄ service
        ‚îÇ   ‚îî‚îÄ‚îÄ DeviceAuthCache.java    // ‚ö° RAM: –ë–µ–ª—ã–π —Å–ø–∏—Å–æ–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
        ‚îú‚îÄ‚îÄ store
        ‚îÇ   ‚îî‚îÄ‚îÄ InMemoryStateStore.java // ‚ö° RAM: –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (params, lastSeen)
        ‚îú‚îÄ‚îÄ engine
        ‚îÇ   ‚îî‚îÄ‚îÄ StateSyncService.java   // üï∞ –§–æ–Ω–æ–≤–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è RAM -> DB
        ‚îú‚îÄ‚îÄ model                       // Entity: DeviceState
        ‚îî‚îÄ‚îÄ repository                  // Spring Data JPA
```

-----
## üß™ –¢–µ–∫—É—â–∞—è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –¢–µ—Å—Ç–æ–≤
```text
src/test/java/com/blinkoff/iot
‚îú‚îÄ‚îÄ shared
‚îÇ   ‚îî‚îÄ‚îÄ security
‚îÇ       ‚îî‚îÄ‚îÄ crypto
‚îÇ           ‚îî‚îÄ‚îÄ AesCryptoEngineTest.java           // ‚úÖ UNIT: –ü—Ä–æ–≤–µ—Ä–∫–∞ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è –∏ –¥–µ—à–∏—Ñ—Ä–æ–≤–∫–∏ (AES-GCM).
‚îÇ
‚îî‚îÄ‚îÄ modules
    ‚îú‚îÄ‚îÄ device_management
    ‚îÇ   ‚îú‚îÄ‚îÄ service
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ DeviceProvisioningServiceTest.java // ‚úÖ UNIT: –õ–æ–≥–∏–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏, –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞, —á–∏—Å—Ç–∫–∞ –∫—ç—à–∞.
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ DeviceBindingServiceTest.java      // ‚úÖ UNIT: –õ–æ–≥–∏–∫–∞ –ø—Ä–∏–≤—è–∑–∫–∏ (–¢–æ–∫–µ–Ω—ã, –õ–∏–º–∏—Ç—ã, –î—É–±–ª–∏–∫–∞—Ç—ã).
    ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ DeviceDataServiceTest.java         // ‚úÖ UNIT: –°–±–æ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç RAM, Fallback DB, –∏–º–µ–Ω–∞ –∏–∑ JSON).
    ‚îÇ   ‚îú‚îÄ‚îÄ store
    ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ProvisioningTokenStoreTest.java    // ‚úÖ UNIT: –†–∞–±–æ—Ç–∞ —Å RAM-—Ç–æ–∫–µ–Ω–∞–º–∏ (TTL, –æ–¥–Ω–æ—Ä–∞–∑–æ–≤–æ—Å—Ç—å).
    ‚îÇ   ‚îú‚îÄ‚îÄ controller
    ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ DeviceProvisioningControllerTest.java // ‚úÖ WEB: –ü—Ä–æ–≤–µ—Ä–∫–∞ HTTP-–∫–æ–¥–æ–≤ (201, 200, 404) –∏ JSON-–æ—Ç–≤–µ—Ç–æ–≤.
    ‚îÇ   ‚îú‚îÄ‚îÄ repository
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ DeviceRepositoryTest.java          // üê¢ INTEG (Testcontainers): –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ/–ü–æ–∏—Å–∫ JSONB.
    ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ DeviceBindingRepositoryTest.java   // üê¢ INTEG (Testcontainers): –ü—Ä–æ–≤–µ—Ä–∫–∞ constraints –ë–î.
    ‚îÇ
    ‚îî‚îÄ‚îÄ telemetry
        ‚îú‚îÄ‚îÄ api
        ‚îÇ   ‚îî‚îÄ‚îÄ device_facing
        ‚îÇ       ‚îî‚îÄ‚îÄ DeviceHandlerTest.java         // ‚úÖ UNIT: WebSocket –ª–æ–≥–∏–∫–∞ (Connect -> Decrypt -> RAM -> Disconnect).
        ‚îú‚îÄ‚îÄ engine
        ‚îÇ   ‚îî‚îÄ‚îÄ StateSyncServiceTest.java          // ‚úÖ UNIT: –ü—Ä–æ–≥—Ä–µ–≤ –∫—ç—à–∞ –∏ —Ñ–æ–Ω–æ–≤–∞—è –∑–∞–ø–∏—Å—å –≤ –ë–î.
        ‚îî‚îÄ‚îÄ repository
            ‚îî‚îÄ‚îÄ DeviceStateRepositoryTest.java     // üê¢ INTEG (Testcontainers): CRUD —Å–æ—Å—Ç–æ—è–Ω–∏–π.
```

-----

## ü§ù –ö–∞–∫ –∫–ª–∞—Å—Å—ã –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É—é—Ç (Interaction Flow)

### 1\. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ (Handshake & Auth)

1.  **ESP32** —Å—Ç—É—á–∏—Ç—Å—è –ø–æ WebSocket —Å –∑–∞–≥–æ–ª–æ–≤–∫–æ–º `X-Chip-Id`.
2.  `DeviceHandshakeInterceptor` —Å–º–æ—Ç—Ä–∏—Ç –≤ `DeviceAuthCache` (RAM).
      * –ï—Å–ª–∏ ID —Ç–∞–º –Ω–µ—Ç (—É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ –∏–ª–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç) ‚Äî **—Ä–∞–∑—Ä—ã–≤ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è**.
      * –ï—Å–ª–∏ ID –µ—Å—Ç—å ‚Äî –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç –¥–∞–ª—å—à–µ.
3.  `DeviceHandler` —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Å—Ç–∞—Ç—É—Å `isOnline = true` –≤ `InMemoryStateStore`.

### 2\. –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö (Telemetry)

1.  **ESP32** —à–ª–µ—Ç –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—É—é —Å—Ç—Ä–æ–∫—É (Base64).
2.  `DeviceHandler` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `AesCryptoEngine` –¥–ª—è –¥–µ—à–∏—Ñ—Ä–æ–≤–∫–∏.
3.  –ü–æ–ª—É—á–µ–Ω–Ω—ã–π JSON –∫–ª–∞–¥–µ—Ç—Å—è –≤ `InMemoryStateStore` (–ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞—è —Å—Ç–∞—Ä—ã–π).
4.  `StateSyncService` (–ø–æ —Ç–∞–π–º–µ—Ä—É —Ä–∞–∑ –≤ 10 —Å–µ–∫) –±–µ—Ä–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ `InMemoryStateStore` –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ PostgreSQL (`DeviceStateRepository`).

### 3\. –ü—Ä–∏–≤—è–∑–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (User Binding)

1.  **–ê–¥–º–∏–Ω** –¥–µ—Ä–≥–∞–µ—Ç API: `DeviceProvisioningService` -\> `ProvisioningTokenStore`. –°–æ–∑–¥–∞–µ—Ç—Å—è —Ç–æ–∫–µ–Ω (–Ω–∞ 5 –º–∏–Ω).
2.  **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å** —à–ª–µ—Ç —Ç–æ–∫–µ–Ω –ë–æ—Ç—É. –ë–æ—Ç —à–ª–µ—Ç –µ–≥–æ –≤ API.
3.  `DeviceBindingService`:
      * –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–æ–∫–µ–Ω –≤ `ProvisioningTokenStore`.
      * –ü–æ–ª—É—á–∞–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–π `ChipId`.
      * –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ª–∏–º–∏—Ç—ã –∏ —Å—Ç–∞—Ç—É—Å `isActive`.
      * –°–æ–∑–¥–∞–µ—Ç –∑–∞–ø–∏—Å—å –≤ `DeviceBindingRepository`.

### 4\. –ß—Ç–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –±–æ—Ç–æ–º (Data Read)

1.  **–ë–æ—Ç** –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç `/api/devices`.
2.  `DeviceDataService`:
      * –ë–µ—Ä–µ—Ç —Å–ø–∏—Å–æ–∫ ID –∏–∑ `DeviceBindingRepository`.
      * –ü—Ä–æ–≤–µ—Ä—è–µ—Ç `DeviceAuthCache` (–Ω–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ –ª–∏?).
      * –ë–µ—Ä–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ `InMemoryStateStore`.
      * **–§–∏—à–∫–∞:** –ï—Å–ª–∏ –≤ RAM –ø—Ä–∏—à–ª–æ –ø–æ–ª–µ `name`, –æ–Ω–æ –∑–∞–º–µ–Ω—è–µ—Ç –∑–∞–≤–æ–¥—Å–∫–æ–µ –∏–º—è –∏–∑ –ë–î.
      * –û—Ç–¥–∞–µ—Ç –≥–æ—Ç–æ–≤—ã–π `DeviceSummaryDto`.

-----

## üì° API –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è (Server Contract)

–≠—Ç–æ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤ (Telegram Bot, Frontend).

### 1\. WebSocket API (–î–ª—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤)

  * **URL:** `ws://host:8080/ws/device`
  * **Headers:** `X-Chip-Id: <CHIP-ID>`
  * **Payload:** –°—Ç—Ä–æ–∫–∞ Base64 (—Ä–µ–∑—É–ª—å—Ç–∞—Ç AES-—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è JSON).
      * *–ü—Ä–∏–º–µ—Ä —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ:* `{"temp": 24.5, "hum": 60, "name": "My Incubator"}`

### 2\. HTTP REST API (–î–ª—è –ë–æ—Ç–∞/–ê–¥–º–∏–Ω–∞)

–í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç JSON. –û—à–∏–±–∫–∏ –ø—Ä–∏—Ö–æ–¥—è—Ç —Å –∫–æ–¥–∞–º–∏ 4xx/5xx –∏ —Ç–µ–ª–æ–º `ApiError`.

#### üõÇ –ì—Ä—É–ø–ø–∞: Provisioning (–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ)

| –ú–µ—Ç–æ–¥ | URL | –û–ø–∏—Å–∞–Ω–∏–µ |
| :--- | :--- | :--- |
| **POST** | `/api/devices/provision` | –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ (–ó–∞–≤–æ–¥). –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç 201. |
| **POST** | `/api/devices/{id}/token` | –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ç–æ–∫–µ–Ω –¥–ª—è –ø—Ä–∏–≤—è–∑–∫–∏. |
| **POST** | `/api/devices/{id}/block` | **–ë–ê–ù**. –°–±—Ä–∞—Å—ã–≤–∞–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è, —á–∏—Å—Ç–∏—Ç –∫—ç—à, —É–¥–∞–ª—è–µ—Ç —é–∑–µ—Ä–æ–≤. |

#### üîó –ì—Ä—É–ø–ø–∞: Bindings (–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –¥–µ–π—Å—Ç–≤–∏—è)

| –ú–µ—Ç–æ–¥ | URL | –¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
| :--- | :--- | :--- | :--- |
| **POST** | `/api/bindings` | `{ "token": "...", "userId": "...", "platform": "TELEGRAM" }` | –ü—Ä–∏–≤—è–∑–∞—Ç—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –ø–æ —Ç–æ–∫–µ–Ω—É. |
| **DELETE** | `/api/bindings` | `?chipId=...&userId=...` | –û—Ç–≤—è–∑–∞—Ç—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ. |

#### üìä –ì—Ä—É–ø–ø–∞: Data (–î–∞–Ω–Ω—ã–µ)

| –ú–µ—Ç–æ–¥ | URL | –ü–∞—Ä–∞–º–µ—Ç—Ä—ã | –û–ø–∏—Å–∞–Ω–∏–µ |
| :--- | :--- | :--- | :--- |
| **GET** | `/api/devices` | `?userId=...` | –°–ø–∏—Å–æ–∫ —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –∏–º–µ–Ω–∞–º–∏ –∏ —Å—Ç–∞—Ç—É—Å–æ–º. |
| **GET** | `/api/devices/{id}/telemetry` | `?userId=...` | –ü–æ–ª–Ω—ã–π JSON –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ + lastSeen. |
